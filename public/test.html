<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Archive Test</title>
</head>
<body>

Follow Form
<!--form for uploading children story-->
<form id="14" enctype="multipart/form-data" method="post" class="follow_form">
  <input type="file" name="media" accept="media">
  <textarea name="story"></textarea>
  <input type="submit">
</form>
<script>
  document.querySelector('.follow_form').addEventListener('submit', (evt) => {
    evt.preventDefault();
    if(document.querySelectorAll('.follow_form input')[0].files.length === 0){
      uploadMedia('text',evt,'child');}

    else if(document.querySelectorAll('.follow_form input')[0].files[0].type.substring(0,5) === 'audio'){
      uploadMedia('audio',  evt,'child');
    }
    else if(document.querySelectorAll('.follow_form input')[0].files[0].type.substring(0,5) === 'image'){
      uploadMedia('image',  evt,'child');
    }
    else if(document.querySelectorAll('.follow_form input')[0].files[0].type.substring(0,5) === 'video'){
      uploadMedia('video',  evt,'child');
    }
    else {
      console.log('incorrect file type');
    }
  });
</script>
<br>
<br>
<br>
<br>
<br>
<br>

Original Form
<!--form for uploading original story-->
<form id="0" enctype="multipart/form-data" method="post" class="original_form">
  <input type="text" name="title">
  <input type="file" name="media" accept="media">
  <textarea name="story"></textarea>
  <input type="submit">
</form>

<script>
  document.querySelector('.original_form').addEventListener('submit', (evt) => {
    evt.preventDefault();
    if(document.querySelectorAll('.original_form input')[1].files.length === 0){
      uploadMedia('text',evt, 'original');}

    else if(document.querySelectorAll('.original_form input')[1].files[0].type.substring(0,5) === 'audio'){
      uploadMedia('audio',  evt, 'original');
    }
    else if(document.querySelectorAll('.original_form input')[1].files[0].type.substring(0,5) === 'image'){
      uploadMedia('image',  evt, 'original');
    }
    else if(document.querySelectorAll('.original_form input')[1].files[0].type.substring(0,5) === 'video'){
      uploadMedia('video',  evt, 'original');
    }
    else {
      console.log('incorrect file type');
    }
  });
</script>
<!--script for uploading stuffs -->
<script>
  const uploadMedia = (type, evt, category)=>{
    console.log('------------------------');
    console.log('trying to /upload'+type+'/');
    evt.preventDefault();
    const fd = new FormData(evt.target);
    const settings = {
      method: 'post',
      body: fd,
    };
    if(category === 'original'){

    }
    else{
      settings.body.append('title', '0');
    }
    settings.body.append('author_id', document.querySelector('main').id);
    settings.body.append('parent_id',evt.target.id);

    console.log('author: '+settings.body.get('author_id'));
    console.log('parent: '+settings.body.get('parent_id'));
    console.log('file: '+settings.body.get('file'));
    console.log('title: '+settings.body.get('title'));
    console.log('story: '+settings.body.get('story'));

    fetch('/node/upload'+type+'/', settings)
    .then((res) => {
    });
  };
</script>
<!-- main iz here -->
<main id="98604">

</main>
<script>
  //init functions
  const grabStory = ()=>{
    const main = document.querySelector('main');
    fetch('/node/grabstory')
    .then(res => res.json())
    .then(json =>{
      for(let i = 0; i<json.length;i++){
        console.log(json[i]);
        const container = document.createElement('div');
        container.id = json[i].story_Id;
        container.style.border = 'solid 1px black';

        const author = document.createElement('p');
        author.innerText = json[i].author;
        author.style.color = 'red';

        const time = document.createElement('p');
        time.innerText = json[i].time;
        time.style.color = 'blue';

        const text = document.createElement('p');
        text.innerText = json[i].content;

        const like = document.createElement('p');
        like.innerText = json[i].like;
        like.style.color = 'blue';

        const dislike = document.createElement('p');
        dislike.innerText = json[i].dislike;
        dislike.style.color = 'red';

        if(json[i].media.substring(0,3) === 'img'){
          const img = document.createElement('img');
          img.src = 'res/media/'+json[i].media;
          container.appendChild(img);
        }
        else if(json[i].media.substring(0,3) === 'bgm'){
          const aud = document.createElement('audio');
          aud.src = 'res/media/'+json[i].media;
          container.appendChild(aud);
        }
        else if(json[i].media.substring(0,3) === 'vid'){
          const vid = document.createElement('vid');
          vid.src = 'res/media/'+json[i].media;
          container.appendChild(vid);
        }

        const commentbox = document.createElement('div');
        for(let j=0;j<json[i].comment.length;j++){
          const comment_segment = document.createElement('div');
          const comment_writer = document.createElement('p');
          comment_writer.innerText = json[i].comment[j].name;
          const comment_time = document.createElement('p');
          comment_time.innerText = json[i].comment[j].comment_time;
          const comment = document.createElement('p');
          comment.innerText = json[i].comment[j].comment;

          comment_segment.appendChild(comment_writer);
          comment_segment.appendChild(comment_time);
          comment_segment.appendChild(comment);
          commentbox.appendChild(comment_segment);
        }
        commentbox.style.fontSize = 'small';
        commentbox.style.backgroundColor = 'wheat';
        container.appendChild(time);
        container.appendChild(author);
        container.appendChild(text);
        container.appendChild(like);
        container.appendChild(dislike);
        container.appendChild(commentbox);
        main.appendChild(container);
      }
    });
  };
  //init functions
  grabStory();
</script>
</body>
</html>